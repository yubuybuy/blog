# 🎉 微信公众号自动发布工具 - 安装完成!

## ✅ 已完成的工作

我为你创建了一个完整的微信公众号自动发布工具,可以将你的 Sanity 博客文章自动同步到公众号,并实现导流到网站获取网盘链接的功能。

### 📁 工具结构

```
wechat-publisher/
├── wechat-auth.js          # 微信认证和Token管理
├── article-converter.js    # 文章格式转换(添加导流)
├── wechat-publisher.js     # 核心发布器
├── sync-to-wechat.js       # 主脚本(Sanity集成)
├── test-config.js          # 配置测试工具
├── README.md               # 完整使用文档
├── 快速开始.md             # 快速上手指南
├── 项目结构说明.md         # 架构说明
├── .env.example            # 环境变量示例
└── .gitignore              # Git忽略规则
```

### 🎯 核心功能

1. **自动获取文章**: 从 Sanity CMS 获取最新博客文章
2. **智能格式转换**: 将 Markdown 转换为公众号富文本格式
3. **导流设计**: 自动添加"点击阅读原文获取资源"引导
4. **批量发布**: 支持批量创建草稿或自动发布
5. **日志记录**: 记录所有发布操作,便于追踪

## 🚀 如何使用

### 第一步: 配置微信公众号

1. 登录 [微信公众平台](https://mp.weixin.qq.com/)
2. 进入 **开发 → 基本配置**
3. 获取 **AppID** 和 **AppSecret**

⚠️ **重要**: 需要**认证的公众号**才能使用此功能

### 第二步: 配置环境变量

在项目根目录的 `.env.local` 文件中添加:

```env
# 微信公众号配置
WECHAT_APP_ID=你的AppID
WECHAT_APP_SECRET=你的AppSecret

# 其他配置应该已经存在
NEXT_PUBLIC_BASE_URL=https://www.sswl.top
```

### 第三步: 测试配置

```bash
npm run wechat:test
```

这会检查:
- ✅ 环境变量是否配置正确
- ✅ 能否成功获取 access_token
- ✅ Sanity CMS 连接是否正常

### 第四步: 开始使用

```bash
# 创建1篇草稿(推荐首次使用)
npm run wechat:draft

# 自动发布1篇文章
npm run wechat:publish

# 批量发布3篇文章
npm run wechat:publish:batch
```

## 💡 导流原理

工具会自动在公众号文章中添加以下内容:

### 1. 摘要导流
```
本文精选优质资源合集...

🔗 点击阅读原文获取网盘资源链接
```

### 2. 正文引导框
```
━━━━━━━━━━━━━━━━━━━━━
📦 如何获取资源?

本文涉及的所有网盘资源链接,
请访问我们的网站获取完整信息

👉 点击【阅读原文】即可查看所有资源链接 👈
━━━━━━━━━━━━━━━━━━━━━
```

### 3. 底部导流
```
⭐ 更多优质资源,请访问我们的网站
www.sswl.top

💡 资源持续更新,建议收藏本站
```

### 4. "阅读原文"链接

微信公众号文章底部的"阅读原文"按钮会自动链接到你的博客文章页面,用户点击后可以:
- 访问你的网站
- 查看完整的网盘链接
- 浏览更多相关文章

## 📊 使用场景

### 场景1: AI写文章后自动同步

```bash
# 1. AI生成文章并发布到Sanity
node your-ai-script.js

# 2. 自动同步到公众号
npm run wechat:draft

# 3. 在公众号后台审核后手动发布
```

### 场景2: 批量同步历史文章

```bash
# 创建5篇草稿
node wechat-publisher/sync-to-wechat.js --limit=5

# 或直接自动发布3篇(注意公众号发布限制)
npm run wechat:publish:batch
```

### 场景3: 定时自动发布

可以配合 cron 或 GitHub Actions 实现定时发布(详见 README.md)

## 📝 API限制说明

微信公众号有以下限制:

| 账号类型 | 群发限制 |
|---------|---------|
| 认证订阅号 | 每天1条 |
| 认证服务号 | 每月4条 |

⚠️ **建议**:
- 首次使用先创建草稿,不要直接发布
- 每天最多同步1篇文章到公众号
- 可以创建多个草稿,手动选择发布时机

## 🔍 查看发布日志

所有发布记录保存在:
```
wechat-publisher/publish-log.json
```

包含:
- 文章标题
- 发布状态 (draft/published/failed)
- media_id
- 时间戳
- 错误信息(如有)

## 📚 详细文档

- **快速开始**: `wechat-publisher/快速开始.md`
- **完整文档**: `wechat-publisher/README.md`
- **项目结构**: `wechat-publisher/项目结构说明.md`

## ⚠️ 注意事项

1. **内容合规**: 确保文章内容符合公众号规范,避免违规
2. **版权安全**: 工具已按照 `AI_CONTENT_RULES.md` 优化,避免版权风险
3. **频率控制**: 不要频繁调用API,避免被限流
4. **Token安全**: 不要提交 `.wechat-token.json` 和 `.env.local` 到代码仓库

## 🎯 实现效果

```
公众号文章
    ↓
用户阅读文章
    ↓
看到"获取资源"引导
    ↓
点击"阅读原文"
    ↓
跳转到你的网站
    ↓
查看网盘链接
    ↓
下载资源
```

这样就实现了:
- ✅ 公众号吸引流量
- ✅ 导流到网站
- ✅ 通过网站获取网盘链接
- ✅ 用户留存和转化

## 🛠️ 故障排除

遇到问题?

1. 运行配置测试: `npm run wechat:test`
2. 查看发布日志: `wechat-publisher/publish-log.json`
3. 查看 README.md 中的"故障排除"章节

## 🚀 开始使用

现在你可以:

```bash
# 1. 测试配置
npm run wechat:test

# 2. 创建第一篇草稿
npm run wechat:draft

# 3. 在公众号后台查看效果
# 访问: https://mp.weixin.qq.com/
```

---

🎉 **祝你使用愉快!通过公众号+网站的组合,实现流量最大化!**

有任何问题,查看 `wechat-publisher/README.md` 获取详细帮助。
